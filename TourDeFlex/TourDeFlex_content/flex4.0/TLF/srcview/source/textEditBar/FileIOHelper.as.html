<!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>FileIOHelper.as</title>
<link rel="stylesheet" type="text/css" href="../../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptpackage">package</span> <span class="ActionScriptDefault_Text">textEditBar</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">display</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">DisplayObject</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">events</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Event</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">events</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">IOErrorEvent</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">net</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">FileReference</span>;
    
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flashx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">textLayout</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">conversion</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ConversionType</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flashx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">textLayout</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">conversion</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ITextExporter</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flashx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">textLayout</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">conversion</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ITextImporter</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flashx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">textLayout</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">conversion</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">TextConverter</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flashx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">textLayout</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">debug</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">assert</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flashx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">textLayout</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">elements</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">TextFlow</span>;
    
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">managers</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">CursorManager</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">managers</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">PopUpManager</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rpc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">events</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ResultEvent</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rpc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">http</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mxml</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">HTTPService</span>;
    
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">textEditBar</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">StatusPopup</span>;
    
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">FileIOHelper</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">parentWindow</span>:<span class="ActionScriptDefault_Text">DisplayObject</span>;
        <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">changeContent</span>:<span class="ActionScriptDefault_Text">Function</span>;

        <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_openedFile</span>:<span class="ActionScriptDefault_Text">String</span>;
        
        <span class="ActionScriptComment">// called when the app has a specific file it wants to read (at startup)
</span>        <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">fileOpen</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">fileName</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">localHTTP</span>:<span class="ActionScriptDefault_Text">HTTPService</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">HTTPService</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
              <span class="ActionScriptDefault_Text">localHTTP</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">url</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">fileName</span>;
              <span class="ActionScriptDefault_Text">_openedFile</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">fileName</span>;
            <span class="ActionScriptDefault_Text">localHTTP</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">method</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">"GET"</span>;
            <span class="ActionScriptDefault_Text">localHTTP</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">resultFormat</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">"text"</span>
            <span class="ActionScriptDefault_Text">localHTTP</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">showBusyCursor</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">true</span>;
            <span class="ActionScriptDefault_Text">localHTTP</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ResultEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">RESULT</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">parseIntoFlowFromHTTP</span><span class="ActionScriptOperator">,</span><span class="ActionScriptReserved">false</span><span class="ActionScriptOperator">,</span>0<span class="ActionScriptOperator">,</span><span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">localHTTP</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">IOErrorEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">IO_ERROR</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">errorOnReadFromHTTP</span><span class="ActionScriptOperator">,</span><span class="ActionScriptReserved">false</span><span class="ActionScriptOperator">,</span>0<span class="ActionScriptOperator">,</span><span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">localHTTP</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">send</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptComment">// called when user picks a file
</span>        <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">fileChoose</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">fileName</span>:<span class="ActionScriptDefault_Text">FileReference</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">fileName</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">COMPLETE</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">onFileReferenceLoadComplete</span><span class="ActionScriptOperator">,</span><span class="ActionScriptReserved">false</span><span class="ActionScriptOperator">,</span>0<span class="ActionScriptOperator">,</span><span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">fileName</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">IOErrorEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">IO_ERROR</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">errorOnReadFromFileReference</span><span class="ActionScriptOperator">,</span><span class="ActionScriptReserved">false</span><span class="ActionScriptOperator">,</span>0<span class="ActionScriptOperator">,</span><span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">fileName</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">load</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">onFileReferenceLoadComplete</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">fileReference</span>:<span class="ActionScriptDefault_Text">FileReference</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">FileReference</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">target</span><span class="ActionScriptBracket/Brace">)</span>;
               <span class="ActionScriptDefault_Text">_extension</span><span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getExtension</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">fileReference</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">name</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toLowerCase</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
               <span class="ActionScriptDefault_Text">_fileData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">fileReference</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">)</span>;
               <span class="ActionScriptDefault_Text">parseCurrentDataWithExtension</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">errorOnReadFromFileReference</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">IOErrorEvent</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">curFileReference</span>:<span class="ActionScriptDefault_Text">FileReference</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">FileReference</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">target</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptComment">// Text content will be an error string
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">errorString</span>:<span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">"Error reading file "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">curFileReference</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">name</span>;
             <span class="ActionScriptDefault_Text">errorString</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptString">"\n"</span>;
             <span class="ActionScriptDefault_Text">errorString</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
             <span class="ActionScriptDefault_Text">_extension</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">"txt"</span>;
             <span class="ActionScriptDefault_Text">_fileData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">errorString</span>;
             <span class="ActionScriptDefault_Text">parseCurrentDataWithExtension</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptComment">//CursorManager.removeBusyCursor(); //get rid of hourglass cursor.             
</span>          <span class="ActionScriptBracket/Brace">}</span>
          
         <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">parseIntoFlowFromHTTP</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">ResultEvent</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> 
         <span class="ActionScriptBracket/Brace">{</span>
               <span class="ActionScriptDefault_Text">_fileData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">result</span><span class="ActionScriptBracket/Brace">)</span>;
               <span class="ActionScriptDefault_Text">_extension</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getExtension</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_openedFile</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toLowerCase</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
               <span class="ActionScriptDefault_Text">parseCurrentDataWithExtension</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
               <span class="ActionScriptDefault_Text">_openedFile</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
         <span class="ActionScriptBracket/Brace">}</span>
         
         <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">errorOnReadFromHTTP</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
         <span class="ActionScriptBracket/Brace">{</span>
             <span class="ActionScriptComment">// Text content will be an error string
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">errorString</span>:<span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">"Error reading file "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_openedFile</span>;
             <span class="ActionScriptDefault_Text">errorString</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptString">"\n"</span>;
             <span class="ActionScriptDefault_Text">errorString</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">fault</span>;
             <span class="ActionScriptDefault_Text">_extension</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">"txt"</span>;
             <span class="ActionScriptDefault_Text">_fileData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">errorString</span>;
             <span class="ActionScriptDefault_Text">parseCurrentDataWithExtension</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">CursorManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeBusyCursor</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//get rid of hourglass cursor. 
</span>                <span class="ActionScriptDefault_Text">_openedFile</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getExtension</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">fileName</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">String</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dotPos</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">fileName</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">lastIndexOf</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"."</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dotPos</span> <span class="ActionScriptOperator">&gt;=</span> 0<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">fileName</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">substring</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dotPos</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">fileName</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptComment">// hold onto these two in case we need to recreate textFlow
</span>        <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_extension</span>:<span class="ActionScriptDefault_Text">String</span>;
        <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_fileData</span>:<span class="ActionScriptDefault_Text">String</span>;
        
        <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">parseCurrentDataWithExtension</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
               <span class="ActionScriptReserved">switch</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_extension</span><span class="ActionScriptBracket/Brace">)</span>
               <span class="ActionScriptBracket/Brace">{</span>
                   <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">"xml"</span>:        <span class="ActionScriptComment">// use Vellum markup
</span>                       <span class="ActionScriptDefault_Text">parseStringIntoFlow</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_fileData</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">TextConverter</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">TEXT_LAYOUT_FORMAT</span><span class="ActionScriptBracket/Brace">)</span>;
                       <span class="ActionScriptReserved">break</span>;
                   <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">"txt"</span>:
                       <span class="ActionScriptDefault_Text">parseStringIntoFlow</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_fileData</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">TextConverter</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">PLAIN_TEXT_FORMAT</span><span class="ActionScriptBracket/Brace">)</span>;
                       <span class="ActionScriptReserved">break</span>;
                <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">"html"</span>:
                       <span class="ActionScriptDefault_Text">parseStringIntoFlow</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_fileData</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">TextConverter</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">TEXT_FIELD_HTML_FORMAT</span><span class="ActionScriptBracket/Brace">)</span>;
                       <span class="ActionScriptReserved">break</span>;

               <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
                
        <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">parseStringIntoFlow</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">source</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">format</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">textImporter</span>:<span class="ActionScriptDefault_Text">ITextImporter</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">TextConverter</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getImporter</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">format</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">newFlow</span>:<span class="ActionScriptDefault_Text">TextFlow</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">textImporter</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">importToFlow</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">source</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">reportImportErrors</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">textImporter</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">errors</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptComment">// no TextFlow found - Flow will display an empty TextFlow by design 
</span>            <span class="ActionScriptComment">// - alternative is to do some kind of error string
</span>            <span class="ActionScriptDefault_Text">changeContent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">newFlow</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">newFlow</span> : <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">TextFlow</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span> 
         
        <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">reportImportErrors</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">errors</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">errors</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">errorText</span>:<span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">"ERRORS REPORTED ON IMPORT"</span>;
                <span class="ActionScriptReserved">for each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">e</span>:<span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">errors</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptDefault_Text">errorText</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptString">"\n"</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">e</span>;
                    
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dlg</span>:<span class="ActionScriptDefault_Text">StatusPopup</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">StatusPopup</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">dlg</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">closeFunction</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">closeStatusPopup</span>;

                <span class="ActionScriptDefault_Text">PopUpManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addPopUp</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dlg</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">parentWindow</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">PopUpManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">centerPopUp</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dlg</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptComment">// stick it in the upper left
</span>                <span class="ActionScriptDefault_Text">dlg</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> 0;
                <span class="ActionScriptDefault_Text">dlg</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> 0;
            
                <span class="ActionScriptDefault_Text">dlg</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">textArea</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">text</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">errorText</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
         <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">closeStatusPopup</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dlg</span>:<span class="ActionScriptDefault_Text">StatusPopup</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
         <span class="ActionScriptBracket/Brace">{</span>
             <span class="ActionScriptDefault_Text">PopUpManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removePopUp</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dlg</span><span class="ActionScriptBracket/Brace">)</span>;
         <span class="ActionScriptBracket/Brace">}</span>
             
        <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">importStatusPopupContent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dlg</span>:<span class="ActionScriptDefault_Text">StatusPopup</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">switch</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dlg</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">textFormat</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">case</span> <span class="ActionScriptDefault_Text">TextConverter</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">TEXT_LAYOUT_FORMAT</span>:
                    <span class="ActionScriptDefault_Text">_extension</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">"xml"</span>;
                    <span class="ActionScriptReserved">break</span>;
                <span class="ActionScriptReserved">case</span> <span class="ActionScriptDefault_Text">TextConverter</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">TEXT_FIELD_HTML_FORMAT</span>:
                    <span class="ActionScriptDefault_Text">_extension</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">"html"</span>;
                    <span class="ActionScriptReserved">break</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptDefault_Text">_fileData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dlg</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">textArea</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">text</span>;
            <span class="ActionScriptDefault_Text">parseCurrentDataWithExtension</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">PopUpManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removePopUp</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dlg</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">saveStatusPopupContent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dlg</span>:<span class="ActionScriptDefault_Text">StatusPopup</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">extension</span>:<span class="ActionScriptDefault_Text">String</span>;
            <span class="ActionScriptReserved">switch</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dlg</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">textFormat</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">case</span> <span class="ActionScriptDefault_Text">TextConverter</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">TEXT_LAYOUT_FORMAT</span>:
                    <span class="ActionScriptDefault_Text">extension</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">"xml"</span>;
                    <span class="ActionScriptReserved">break</span>;
                <span class="ActionScriptReserved">case</span> <span class="ActionScriptDefault_Text">TextConverter</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">TEXT_FIELD_HTML_FORMAT</span>:
                    <span class="ActionScriptDefault_Text">extension</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">"html"</span>;
                    <span class="ActionScriptReserved">break</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
              <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">fileReference</span>:<span class="ActionScriptDefault_Text">FileReference</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">FileReference</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
              <span class="ActionScriptDefault_Text">fileReference</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">save</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dlg</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">textArea</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">text</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">extension</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptReserved">null</span> : <span class="ActionScriptString">"NewFile."</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">extension</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        


        <span class="ActionScriptComment">// Export related code
</span>        <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">textLayoutExport</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">activeFlow</span>:<span class="ActionScriptDefault_Text">TextFlow</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>        
            <span class="ActionScriptDefault_Text">export</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">activeFlow</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">TextConverter</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">TEXT_LAYOUT_FORMAT</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>


        <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">htmlExport</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">activeFlow</span>:<span class="ActionScriptDefault_Text">TextFlow</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">export</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">activeFlow</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">TextConverter</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">TEXT_FIELD_HTML_FORMAT</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">xmlBoilerPlate</span>:<span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">'&lt;?xml version="1.0" encoding="utf-8"?&gt;\n'</span>;
                                        
        <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">export</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">activeFlow</span>:<span class="ActionScriptDefault_Text">TextFlow</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">format</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">//CONFIG::debug
</span>            <span class="ActionScriptBracket/Brace">{</span>    
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">originalSettings</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">XML</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">settings</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">try</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">XML</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ignoreProcessingInstructions</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;        
                    <span class="ActionScriptDefault_Text">XML</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ignoreWhitespace</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
                    <span class="ActionScriptDefault_Text">XML</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">prettyPrinting</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
                    
                    
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">exporter</span>:<span class="ActionScriptDefault_Text">ITextExporter</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">TextConverter</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getExporter</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">format</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">xmlExport</span>:<span class="ActionScriptDefault_Text">XML</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">exporter</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">export</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">activeFlow</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">ConversionType</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">XML_TYPE</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">XML</span>;
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">result</span>:<span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">xmlBoilerPlate</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">xmlExport</span>;                    
                    <span class="ActionScriptDefault_Text">XML</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setSettings</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">originalSettings</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptReserved">catch</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span>:<span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">XML</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setSettings</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">originalSettings</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptReserved">throw</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">// show it in the pop-up dialog
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dlg</span>:<span class="ActionScriptDefault_Text">StatusPopup</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">StatusPopup</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">dlg</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">closeFunction</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">closeStatusPopup</span>;
            <span class="ActionScriptDefault_Text">dlg</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">importFunction</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">importStatusPopupContent</span>;
            <span class="ActionScriptDefault_Text">dlg</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">saveFunction</span>   <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">saveStatusPopupContent</span>;
            <span class="ActionScriptDefault_Text">dlg</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">textFormat</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">format</span>;
            
            <span class="ActionScriptDefault_Text">PopUpManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addPopUp</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dlg</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">parentWindow</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">PopUpManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">centerPopUp</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dlg</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptComment">// stick it in the upper left
</span>            <span class="ActionScriptDefault_Text">dlg</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptDefault_Text">dlg</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> 0;
    
            <span class="ActionScriptDefault_Text">dlg</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">textArea</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">text</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">result</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">replace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">/\u000D\u000A/g</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptString">"\r"</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// workaround for TextArea bug SDK-14797
</span>        <span class="ActionScriptBracket/Brace">}</span>
        


    <span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptBracket/Brace">}</span>
</pre></body>
</html>
